<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulace Displeje 320x192 (WebGL)</title>
    <!-- Načtení Tailwind CSS pro pozadí těla a základní styly -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Načtení Three.js pro WebGL rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            /* Absolutní černá podklad */
            background-color: #000000;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Zabrání rolování celé stránky */
        }
        /* Kontejner pro WebGL canvas */
        #webgl-container {
            position: fixed;
            top: 0;
            left: 0;
            /* Three.js canvas bude mít přesně 320x192 */
            width: 320px;
            height: 192px;
            /* Zajištění, že se nic nevyleje mimo rozměr */
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-black">

    <!-- Kontejner pro WebGL renderovací plátno -->
    <div id="webgl-container"></div>

    <script>
        // --- KONFIGURACE ---
        const DISPLAY_WIDTH = 320;
        const DISPLAY_HEIGHT = 192;
        const FONT_SIZE = 8; // px
        const LINE_HEIGHT = 10; // 8px font + 2px mezera = 10px
        const SCROLL_SPEED_PX_PER_SEC = 50; // Rychlost rolování v pixelech za sekundu
        const TEXT_COLOR = '#E2E8F0';
        const BACKGROUND_COLOR = '#000000';
        
        // --- DATA ---
        const STATIC_TEXT = [
            // První řádek je animovaný, začíná od druhého indexu
            "[2] Projekt \"Nano-Banana\" v2.1.",
            "[3] Poslední měření:",
            "Teplota: 21.5 C",
            "Vlhkost: 45.2 %",
            "Napeti:  3.3 V",
            "Status: OK (System stabilni)",
            "Cas: 2025/11/13 10:01:45",
            "Ulozeno: 1478 zaznamu",
            "Pamet: 87% volne",
            "Tento text je úmyslně delší, aby překročil pevně definovanou výšku 192px. Vše, co se nachází mimo tuto oblast, je striktně oříznuto."
        ];
        const SCROLLING_TEXT_BASE = "[1] Návrh obvodu pro nízkopříkonový senzor teploty a vlhkosti.    ";
        
        let scene, camera, renderer, plane, canvas, ctx, texture;
        let scrollOffset = 0; // Aktuální posun rolování
        let lastTime = 0;

        /**
         * Inicializace Three.js scény a rendereru
         */
        function initWebGL() {
            // 1. SCÉNA
            scene = new THREE.Scene();

            // 2. KAMERA (Ortografická pro 2D)
            camera = new THREE.OrthographicCamera(
                DISPLAY_WIDTH / - 2, 
                DISPLAY_WIDTH / 2, 
                DISPLAY_HEIGHT / 2, 
                DISPLAY_HEIGHT / - 2, 
                1, 
                1000
            );
            camera.position.z = 1; // Posuneme kameru zpět, aby viděla rovinu

            // 3. RENDERER
            renderer = new THREE.WebGLRenderer({ antialias: false });
            renderer.setSize(DISPLAY_WIDTH, DISPLAY_HEIGHT);
            renderer.setClearColor(BACKGROUND_COLOR, 1);
            
            const container = document.getElementById('webgl-container');
            container.appendChild(renderer.domElement);
            
            // 4. TEXTURA A ROVINA
            initTextCanvas();

            // Geometrie roviny, která se roztáhne přes celou obrazovku
            const geometry = new THREE.PlaneGeometry(DISPLAY_WIDTH, DISPLAY_HEIGHT); 
            // Materiál s naší texturou
            const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });

            // Rovina umístěná uprostřed kamery (0, 0)
            plane = new THREE.Mesh(geometry, material);
            scene.add(plane);
        }

        /**
         * Inicializuje interní 2D Canvas pro textury
         */
        function initTextCanvas() {
            canvas = document.createElement('canvas');
            canvas.width = DISPLAY_WIDTH;
            canvas.height = DISPLAY_HEIGHT;
            ctx = canvas.getContext('2d');
            
            // Vytvoření textury z plátna
            texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
        }

        /**
         * Vykreslí veškerý obsah na interní 2D plátno
         */
        function drawTextContent() {
            // Vyčistit pozadí (černá)
            ctx.fillStyle = BACKGROUND_COLOR;
            ctx.fillRect(0, 0, DISPLAY_WIDTH, DISPLAY_HEIGHT);

            // Nastavení stylu písma
            ctx.font = `${FONT_SIZE}px 'Inter', monospace`; 
            ctx.fillStyle = TEXT_COLOR;
            ctx.textBaseline = 'top';

            // --- Vykreslení statického textu ---
            STATIC_TEXT.forEach((line, index) => {
                // Vypočítáme Y pozici (začíná od druhého řádku, index 1)
                const y = (index + 1) * LINE_HEIGHT + 1; // +1 pro malý offset z původního kódu
                ctx.fillText(line, 4, y); // Malý X offset
            });
            
            // --- Vykreslení rolovacího textu ---
            
            // Text je zdvojený pro plynulou smyčku
            const scrollingTextContent = SCROLLING_TEXT_BASE + SCROLLING_TEXT_BASE;
            
            // Změříme šířku textu
            const textMetrics = ctx.measureText(SCROLLING_TEXT_BASE);
            const textWidth = textMetrics.width;

            // Vypočítáme aktuální posun a zajistíme smyčku
            // scrollOffset je záporný pro pohyb doleva
            const currentScrollX = scrollOffset % textWidth; 

            // Vykreslíme text s aktuálním posunem. Y pozice je pro první řádek.
            ctx.fillText(scrollingTextContent, 4 + currentScrollX, 1);
            
            // Označíme texturu jako aktualizovanou pro Three.js
            texture.needsUpdate = true; 
        }

        /**
         * Hlavní animační smyčka (Game Loop)
         */
        function animate(time) {
            requestAnimationFrame(animate);

            if (lastTime !== 0) {
                const delta = (time - lastTime) / 1000; // Čas v sekundách od posledního snímku
                
                // Aktualizace posunu rolování (50px/sec * delta_cas)
                // Posun je záporný, protože se posouvá doleva
                scrollOffset -= SCROLL_SPEED_PX_PER_SEC * delta; 
            }
            lastTime = time;

            // 1. Aktualizace obsahu (text + rolování)
            drawTextContent();

            // 2. Renderování WebGL scény
            renderer.render(scene, camera);
        }

        // --- Spuštění po načtení okna ---
        window.onload = function () {
            try {
                initWebGL();
                animate(0); // Spustit animační smyčku
            } catch (e) {
                const container = document.getElementById('webgl-container');
                container.innerHTML = `<div style="color: white; padding: 20px;">
                    Chyba při inicializaci WebGL: ${e.message}.
                    Webová aplikace vyžaduje podporu WebGL.
                </div>`;
                console.error("WebGL initialization failed:", e);
            }
        };

    </script>

</body>
</html>
